(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1044:function(e,n,i){Promise.resolve().then(i.bind(i,2930))},2930:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return w}});var t=i(7437),o=i(2265),r=i(3355),a=i(2218),s=i(4839),c=i(6164);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=o.forwardRef((e,n)=>{let{className:i,variant:o,size:a,asChild:d=!1,...u}=e,f=d?r.g7:"button";return(0,t.jsx)(f,{className:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0,c.m6)((0,s.W)(n))}(l({variant:o,size:a,className:i})),ref:n,...u})});d.displayName="Button";var u=i(8267),f=i(5236);let v=0===(0,f.C6)().length?(0,f.ZF)({apiKey:"AIzaSyBBivd0UUZmQqu3ZlOcpwqWaOl2BJK3lwU",authDomain:"nextjs-notification-51cb0.firebaseapp.com",projectId:"nextjs-notification-51cb0",storageBucket:"nextjs-notification-51cb0.firebasestorage.app",messagingSenderId:"636915540044",appId:"1:636915540044:web:9f520f37016cae05a194e9",measurementId:"G-P8BHP5MQG1"}):(0,f.Mq)(),g=async()=>await (0,u.Gb)()?(0,u.KL)(v):null,p=async()=>{try{let e=await g();if(e)return await (0,u.LP)(e,{vapidKey:"BMXUhOVqTY5opaNEtua5Ku6BnI6qfk2vFTHdZVTyYZ-hmWWUfkI6wZhqg5tmJvSQebS2tvoTrReOPOhRv0ofoqY"});return null}catch(e){return console.error("An error occurred while fetching the token:",e),null}};var h=i(6463),b=i(7776);async function m(){return"Notification"in window?"granted"===Notification.permission||"denied"!==Notification.permission&&"granted"===await Notification.requestPermission()?await p():(console.log("Notification permission not granted."),null):(console.info("This browser does not support desktop notification"),null)}var y=()=>{let e=(0,h.useRouter)(),[n,i]=(0,o.useState)(null),[t,r]=(0,o.useState)(null),a=(0,o.useRef)(0),s=(0,o.useRef)(!1),c=async()=>{if(s.current)return;s.current=!0;let e=await m();if("denied"===Notification.permission){i("denied"),console.info("%cPush Notifications issue - permission denied","color: green; background: #c7c7c7; padding: 8px; font-size: 20px"),s.current=!1;return}if(!e){if(a.current>=3){alert("Unable to load token, refresh the browser"),console.info("%cPush Notifications issue - unable to load token after 3 retries","color: green; background: #c7c7c7; padding: 8px; font-size: 20px"),s.current=!1;return}a.current+=1,console.error("An error occurred while retrieving token. Retrying..."),s.current=!1,await c();return}i(Notification.permission),r(e),s.current=!1};return(0,o.useEffect)(()=>{"Notification"in window&&c()},[]),(0,o.useEffect)(()=>{let n=null;return(async()=>{if(!t)return;console.log("onMessage registered with token ".concat(t));let n=await g();if(n)return(0,u.ps)(n,n=>{var i,t,o,r,a,s,c,l;if("granted"!==Notification.permission)return;console.log("Foreground push notification received:",n);let d=(null===(i=n.fcmOptions)||void 0===i?void 0:i.link)||(null===(t=n.data)||void 0===t?void 0:t.link);d?b.Am.info("".concat(null===(a=n.notification)||void 0===a?void 0:a.title,": ").concat(null===(s=n.notification)||void 0===s?void 0:s.body),{action:{label:"Visit",onClick:()=>{var i,t;let o=(null===(i=n.fcmOptions)||void 0===i?void 0:i.link)||(null===(t=n.data)||void 0===t?void 0:t.link);o&&e.push(o)}}}):b.Am.info("".concat(null===(c=n.notification)||void 0===c?void 0:c.title,": ").concat(null===(l=n.notification)||void 0===l?void 0:l.body)),new Notification((null===(o=n.notification)||void 0===o?void 0:o.title)||"New message",{body:(null===(r=n.notification)||void 0===r?void 0:r.body)||"This is a new message",data:d?{url:d}:void 0}).onclick=n=>{var i,t;n.preventDefault();let o=null===(t=n.target)||void 0===t?void 0:null===(i=t.data)||void 0===i?void 0:i.url;o?e.push(o):console.log("No link found in the notification payload")}})})().then(e=>{e&&(n=e)}),()=>null==n?void 0:n()},[t,e,b.Am]),{token:t,notificationPermissionStatus:n}};function w(){let{token:e,notificationPermissionStatus:n}=y(),i=async()=>{let n=await fetch("/send-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,title:"Test Notification",message:"This is a test notification",link:"/contact"})});console.log(await n.json())};return(0,t.jsxs)("main",{className:"p-10",children:[(0,t.jsx)("h1",{className:"text-4xl mb-4 font-bold",children:"Firebase Cloud Messaging Demo"}),"granted"===n?(0,t.jsx)("p",{children:"Permission to receive notifications has been granted."}):null!==n?(0,t.jsx)("p",{children:"You have not granted permission to receive notifications. Please enable notifications in your browser settings."}):null,(0,t.jsx)(d,{disabled:!e,className:"mt-5",onClick:i,children:"Send Test Notification"})]})}}},function(e){e.O(0,[776,32,971,23,744],function(){return e(e.s=1044)}),_N_E=e.O()}]);